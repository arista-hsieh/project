<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>一周冷便當</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css"
      integrity="sha512-MV7K8+y+gLIBoVD59lQIYicR65iaqukzvf/nwasF0nqhPay5w/9lJmVM2hMDcnK1OnMGCdVK+iQrJ7lzPJQd1w=="
      crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.0/css/all.min.css" />
    <link rel="stylesheet" href="./assets/style/all.css">
  </head>

  <body>
    <div class="navOuter">
      <div class="container">
        <nav>
          <a href="index.html"><img src="./assets/images/logo.png" alt="logo"></a>
          <div>
            <ul>
              <li><a href="main.html">冷便當食譜</a></li>
              <li><a href="qa.html">冷便當小教室</a></li>
              <li><a href="bookmark.html">我的收藏</a></li>
              <li class="js-login"><a href="login.html">會員登入</a></li>
            </ul>
          </div>
        </nav>
      </div>
      <div class="mobile">
        <div class="navMobile">
          <a class="pt-3 pb-3 ms-3" href="index.html"><img src="./assets/images/logo.png" alt="logo"></a>
          <div class="menu pt-3 me-3 pt-sm-4 me-sm-5"><i class="fa-solid fa-bars"></i>
          </div>
        </div>
        <ul class="navBar">
          <li><a href="main.html">冷便當食譜</a></li>
          <li><a href="qa.html">冷便當小教室</a></li>
          <li><a href="bookmark.html">我的收藏</a></li>
          <li><a href="login.html">會員登入</a></li>
        </ul>
      </div>
    </div>


    
<div class="search p-5">
  <label for="search">
    <input type="text" id="search" placeholder="海鮮/排骨/三明治">
    <div class="btn btn-primary ms-sm-2">搜尋</div>
  </label>
</div>

<section class="wrap">
  <div class="container">
    <div class="week">
      <div class="selectMenu js-need-login">
        <ul>
          <li class="active"><a href="main.html">一周冷便當</a></li>
          <li><a href="light.html">輕食冷便當</a></li>
          <li><a href="market.html">超商冷便當</a></li>
          <li><a href="popular.html">熱門冷便當</a></li>
        </ul>
      </div>

      <ul class="cardCollect js-bookmark-state js-post-list list-unstyled">
        <li class="card mb-3" style="width: 18rem;">
          <img src="./assets/images/banto01.jpg" class="card-img-top" alt="...">
          <div class="card-body">
            <h5 class="card-title">竹筍燒雞便當</h5>
            <div class="card-text">
              <div class="like">16 like</div>
              <span class="bookmark"><input type="button" value="加入收藏" class="js-add-bookmarks btn btn-light" />
                <input type="button" value="取消收藏" class="js-remove-bookmarks btn btn-light" /><img
                  src="./assets/images/icon-like-filled.png" alt="bookmark"></span>
            </div>
          </div>
        </li>

        <div class="card mb-3" style="width: 18rem;">
          <img src="./assets/images/banto02.jpg" class="card-img-top" alt="...">
          <div class="card-body">
            <h5 class="card-title">酥炸肉排便當</h5>
            <div class="card-text">
              <div class="like">16 like</div>
              <span class="bookmark"><img src="./assets/images/icon-like-filled.png" alt="bookmark"></span>
            </div>
          </div>
        </div>

        <div class="card mb-3" style="width: 18rem;">
          <img src="./assets/images/banto03.jpg" class="card-img-top" alt="...">
          <div class="card-body">
            <h5 class="card-title">大阪蜜汁燒便當</h5>
            <div class="card-text">
              <div class="like">16 like</div>
              <span class="bookmark"><img src="./assets/images/icon-like-filled.png" alt="bookmark"></span>
            </div>
          </div>
        </div>

        <div class="card mb-3" style="width: 18rem;">
          <img src="./assets/images/banto04.jpg" class="card-img-top" alt="...">
          <div class="card-body">
            <h5 class="card-title">香煎鱸魚排便當</h5>
            <div class="card-text">
              <div class="like">16 like</div>
              <span class="bookmark"><img src="./assets/images/icon-like-filled.png" alt="bookmark"></span>
            </div>
          </div>
        </div>

        <div class="card mb-3" style="width: 18rem;">
          <img src="./assets/images/banto09.jpg" class="card-img-top" alt="...">
          <div class="card-body">
            <h5 class="card-title">玉米漢堡飯糰便當</h5>
            <div class="card-text">
              <div class="like">16 like</div>
              <span class="bookmark"><img src="./assets/images/icon-like-filled.png" alt="bookmark"></span>
            </div>
          </div>
        </div>

        <div class="card mb-3" style="width: 18rem;">
          <img src="./assets/images/banto10.jpg" class="card-img-top" alt="...">
          <div class="card-body">
            <h5 class="card-title">腐乳雞翅便當</h5>
            <div class="card-text">
              <div class="like">16 like</div>
              <span class="bookmark"><img src="./assets/images/icon-like-filled.png" alt="bookmark"></span>
            </div>
          </div>
        </div>

        <div class="card mb-3" style="width: 18rem;">
          <img src="./assets/images/banto11.jpg" class="card-img-top" alt="...">
          <div class="card-body">
            <h5 class="card-title">韓式燒肉便當</h5>
            <div class="card-text">
              <div class="like">16 like</div>
              <span class="bookmark"><img src="./assets/images/icon-like-filled.png" alt="bookmark"></span>
            </div>
          </div>
        </div>

        <div class="card mb-3" style="width: 18rem;">
          <img src="./assets/images/banto12.jpg" class="card-img-top" alt="...">
          <div class="card-body">
            <h5 class="card-title">孜然翅腿便當</h5>
            <div class="card-text">
              <div class="like">16 like</div>
              <span class="bookmark"><img src="./assets/images/icon-like-filled.png" alt="bookmark"></span>
            </div>
          </div>
        </div>

        <div class="card mb-3" style="width: 18rem;">
          <img src="./assets/images/banto13.jpg" class="card-img-top" alt="...">
          <div class="card-body">
            <h5 class="card-title">橙汁魚片便當</h5>
            <div class="card-text">
              <div class="like">16 like</div>
              <span class="bookmark"><img src="./assets/images/icon-like-filled.png" alt="bookmark"></span>
            </div>
          </div>
        </div>

        <div class="card mb-3" style="width: 18rem;">
          <img src="./assets/images/banto14.jpg" class="card-img-top" alt="...">
          <div class="card-body">
            <h5 class="card-title">菠菜鮮蝦義大利麵便當</h5>
            <div class="card-text">
              <div class="like">16 like</div>
              <span class="bookmark"><img src="./assets/images/icon-like-filled.png" alt="bookmark"></span>
            </div>
          </div>
        </div>

      </ul>

    </div>
  </div>
</section>

<script src="https://unpkg.com/axios@1.1.2/dist/axios.min.js"></script>
<script>
  const BASE_URL = 'https://json-server-zeta-eight.vercel.app';
  const BASE_POST_URL = `${BASE_URL}/posts`;
  const BOOKMARKS_URL = `${BASE_URL}/600/bookmarks`;
  const USERS_URL = `${BASE_URL}/600/users`;

  const domPostList = document.querySelector('.js-post-list');
  const domState = document.querySelector('.js-bookmark-state');

  const btnAddBookmark = document.querySelector('.js-add-bookmarks');
  const btnRemoveBookmark = document.querySelector('.js-remove-bookmarks');

  let bookmarkId = 0;
  /* end of definition */

  function getLoggedID() {
    return localStorage.getItem('userId') || 0;
  }
  /* end of hasLogged() */

  function renderBookmarkState() {
    const params = new URLSearchParams(document.location.search);
    const postId = params.get('postId') || 1;
    console.log('postId:::', postId);

    const userId = getLoggedID();
    // users/1/bookmarks?postId=2
    const url = `${USERS_URL}/${userId}/bookmarks?postId=${postId}`;

    console.log('url:::', url);

    axios
      .get(url)
      .then(function (response) {
        console.log('GET-:::', JSON.stringify(response, null, 2));

        if (response.data.length !== 0) {
          bookmarkId = response.data[0].id;

          domState.innerHTML = `                
              已收藏
          `;

          btnRemoveBookmark.style.display = 'block';
          btnAddBookmark.style.display = 'none';
        }
        /* end of res-OK */

        if (response.data.length === 0) {
          domState.innerHTML = `                
              未收藏
          `;

          btnRemoveBookmark.style.display = 'none';
          btnAddBookmark.style.display = 'block';
        }
      })
      .catch(function (error) {
        // console.log('error:::', JSON.stringify(error, null, 2));
      });
    /*  end of axios */
  }
  /* end of renderBookmarkBtn() */

  function removeBookmark() {
    console.log(bookmarkId);

    const url = `${BOOKMARKS_URL}/${bookmarkId}`;

    axios
      .delete(url)
      .then(function (response) {
        console.log('DELETE-:::', JSON.stringify(response, null, 2));

        if (response.status === 200) {
          console.log('200');

          renderBookmarkState();
        }
        /* end of res-OK */
      })
      .catch(function (error) {
        // console.log('error:::', JSON.stringify(error, null, 2));
      });
    /*  end of axios */
  }
  /* end of removeBookmark() */

  function addBookmark() {
    const params = new URLSearchParams(document.location.search);
    const postId = params.get('postId') || 1;
    console.log('postId:::', postId);

    const url = `${BASE_POST_URL}/${postId}/bookmarks`;

    const data = {
      userId: getLoggedID(),
    };

    axios
      .post(url, data)
      .then(function (response) {
        console.log('GET-:::', JSON.stringify(response, null, 2));

        if (response.status === 201) {
          renderBookmarkState();
        }
        /* end of res-OK */
      })
      .catch(function (error) {
        // console.log('error:::', JSON.stringify(error, null, 2));
      });
    /*  end of axios */
  }
  /* end of addBookmark() */

  function renderPostInfo() {
    const params = new URLSearchParams(document.location.search);
    const postId = params.get('postId') || 1;
    console.log('postId:::', postId);

    const url = `${BASE_POST_URL}`;

    axios
      .get(url)
      .then(function (response) {
        console.log('GET-Posts:::', JSON.stringify(response, null, 2));

        str = ""
        if (response.status === 200) {
          // #Step-2
          const postsData = response.data;
          console.log(postsData)
          // const htmlContent = templateOfPosts(postsData);

          // #Step-3
          // domPostList.innerHTML = htmlContent;
          postsData.forEach(function (item) {
            if (item.category == "一周冷便當") {
              str += `<li class="card mb-3" style="width: 18rem;">
          <img src="${item.img}" class="card-img-top" alt="...">
          <div class="card-body">
            <h5 class="card-title">${item.title}</h5>
            <div class="card-text">
              <div class="like">16 like</div>
              <span class="bookmark"><img src="./assets/images/icon-like-filled.png" alt="bookmark"></span>
            </div>
          </div>
        </li>`
            }
          })
          domPostList.innerHTML = str;
        }
        /* end of res-OK */
      })
      .catch(function (error) {
        // console.log('error:::', JSON.stringify(error, null, 2));
      });
    /*  end of axios */
  }
  /* end of renderPostInfo() */

  /**
   * #Step-0: after page refresh
   */
  function init() {
    renderPostInfo();

    const hasUserId = getLoggedID();

    if (hasUserId) {
      renderBookmarkState();
    }

    if (!hasUserId) {
      document.querySelector('.js-need-login').style.display = 'none';
    }

    btnAddBookmark.addEventListener('click', () => addBookmark());
    btnRemoveBookmark.addEventListener('click', () => removeBookmark());
  }
  /* end of init() */

  // MAIN
  init();
</script>

    <footer class="footer p-3">
      此專題僅為面試作品所用，非商業營利性質
    </footer>

    <script src="https://code.jquery.com/jquery-3.6.1.min.js"
      integrity="sha256-o88AwQnZB+VDvE9tvIXrMQaPlFFSUTR+nldQm1LuPXQ=" crossorigin="anonymous"></script>
    <script src="https://unpkg.com/axios@1.1.2/dist/axios.min.js"></script>
    <script src="./assets/js/all.js"></script>
    <script>
      $(function () {
        $(".navBar").hide();
        $(".fa-bars").click(function () {
          $(".fa-bars").toggleClass('fa-xmark')
          $(".navBar").slideToggle();
        })
      })
    </script>
  </body>

</html>