<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>一起帶冷便當</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css"
      integrity="sha512-MV7K8+y+gLIBoVD59lQIYicR65iaqukzvf/nwasF0nqhPay5w/9lJmVM2hMDcnK1OnMGCdVK+iQrJ7lzPJQd1w=="
      crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.0/css/all.min.css" />
    <link rel="stylesheet" href="./assets/style/all.css">
  </head>

  <body>
    <div class="navOuter">
      <div class="container">
        <nav>
          <a href="index.html"><img src="./assets/images/logo.png" alt="logo"></a>
          <div>
            <ul>
              <li><a href="main.html">冷便當食譜</a></li>
              <li><a href="qa.html">冷便當小教室</a></li>
              <li><a href="bookmark.html">我的收藏</a></li>
              <li><a href="login.html">會員登入</a></li>
            </ul>
          </div>
        </nav>
      </div>
      <div class="mobile">
        <div class="navMobile">
          <a class="pt-3 pb-3 ms-3" href="index.html"><img src="./assets/images/logo.png" alt="logo"></a>
          <div class="menu pt-3 me-3 pt-sm-4 me-sm-5"><i class="fa-solid fa-bars"></i>
          </div>
        </div>
        <ul class="navBar">
          <li><a href="main.html">冷便當食譜</a></li>
          <li><a href="qa.html">冷便當小教室</a></li>
          <li><a href="bookmark.html">我的收藏</a></li>
          <li><a href="login.html">會員登入</a></li>
        </ul>
      </div>
    </div>


    
<div class="js-post-list cardCollect">

</div>

<script src="https://unpkg.com/axios@1.1.2/dist/axios.min.js"></script>
<script>
  const BASE_POST_URL = `${BASE_URL}/640/posts`;
  const BOOKMARKS_URL = `${BASE_URL}/600/bookmarks`;

  const domPostList = document.querySelector('.js-post-list');

  function getLoggedID() {
    return localStorage.getItem('userId') || 0;
  }

  function removeBookmarks(event) {
    const target = event.target;
    console.log('target:::', target);

    const targetBtn = event.target.closest('button');
    console.log('targetBtn:::', targetBtn);

    if (!targetBtn) {
      return;
    }

    const bookmarkId = targetBtn.dataset.bookmarkId;
    console.log('bookmarkId:::', bookmarkId);

    const url = `${BOOKMARKS_URL}/${bookmarkId}`;

    axios
      .delete(url)
      .then(function (response) {

        if (response.status === 200) {
          targetBtn.disabled = false;
          renderBookmarks();
        }
      })
      .catch(function (error) {
        console.log('error:::', JSON.stringify(error, null, 2));
      });
  }

  function templateOfBookmarks(bookmarks, template = ``) {
    bookmarks.forEach(function (bookmark) {
      const article = bookmark.post.body ? bookmark.post.body : '';

      template += `
            <li
              data-bookmark-id=${bookmark.id}
              class="col-sm-6 col-lg-4 mb-4"
            >
              <div class="card">
                <section class="card-body">

                  <div class="d-flex justify-content-end align-items-center p-0">
                    <button type="button"
                      class="d-flex justify-content-end align-items-center gap-1 px-1 mb-2
                        btn btn-sm btn-secondary"
                      data-type="DELETE"
                      data-bookmark-id=${bookmark.id}
                    >
                      已收藏
                      <span class="material-symbols-outlined">
                        bookmark_added
                      </span>
                    </button>
                  </div>

                  <h3 class="card-title  text-truncate">
                    ${bookmark.post.title}
                  </h3>

                  <article class="card-text  text-truncate">
                    ${article}
                  </article>

                </section>
              </div>
            </li>
          `;
    });

    return template;
  }

  function renderBookmarks() {
    const userId = getLoggedID();
    const url = `${BASE_URL}/users/${userId}/bookmarks?_expand=post`;

    axios
      .get(url)
      .then(function (response) {
        console.log('GET-Posts:::', JSON.stringify(response, null, 2));

        if (response.status === 200) {
          const bookmarksData = response.data;
          const htmlContent = templateOfBookmarks(bookmarksData);

          domPostList.innerHTML = htmlContent;

          if (response.data.length === 0) {
            domPostList.innerHTML = '...還沒有收藏 (◕ᴥ◕Ʋ)';
          }
        }
      })
      .catch(function (error) {

      });
  }

  function init() {
    renderBookmarks();

    domPostList.addEventListener('click', (event) =>
      removeBookmarks(event)
    );
  }

  init();
</script>

    <footer class="footer p-3">
      此專題僅為面試作品所用，非商業營利性質
    </footer>

    <script src="https://code.jquery.com/jquery-3.6.1.min.js"
      integrity="sha256-o88AwQnZB+VDvE9tvIXrMQaPlFFSUTR+nldQm1LuPXQ=" crossorigin="anonymous"></script>
    <script src="https://unpkg.com/axios@1.1.2/dist/axios.min.js"></script>
    <script src="./assets/js/all.js"></script>
    <script>
      $(function () {
        $(".navBar").hide();
        $(".fa-bars").click(function () {
          $(".fa-bars").toggleClass('fa-xmark')
          $(".navBar").slideToggle();
        })
      })
    </script>
  </body>

</html>